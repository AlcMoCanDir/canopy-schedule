<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Session 3 Schedule Builder</title>

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f6f6f6;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: white;
      border-radius: 8px;
      padding: 20px;
      border: 1px solid #ddd;
    }
    h1 { text-align: center; color: #2a6f33; margin-bottom: 10px; }

    .student-info { text-align: center; margin-bottom: 20px; }
    .student-info input {
      border: 1px solid #2a6f33;
      border-radius: 4px;
      padding: 6px;
      width: 260px;
      font-size: 14px;
    }

    .filters {
      margin-bottom: 15px;
      text-align: center;
    }
    .filters label {
      margin: 0 10px;
      font-size: 14px;
    }

    .tabs {
      display: flex;
      gap: 10px;
      border-bottom: 2px solid #2a6f33;
      margin-bottom: 10px;
      justify-content: center;
    }
    .tab {
      padding: 10px 20px;
      border-radius: 6px 6px 0 0;
      background: #dedede;
      cursor: pointer;
      border: none;
    }
    .tab.active { background: #2a6f33; color: white; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .schedule-table {
      width: 100%;
      border-collapse: collapse;
    }
    .schedule-table th, .schedule-table td {
      border: 1px solid #ccc;
      padding: 6px;
      font-size: 11px;
    }
    .schedule-table th {
      background: #2a6f33;
      color: white;
      font-size: 12px;
      text-align: center;
    }
    .time-col {
      width: 100px;
      background: #2274cd;
      color: white;
      font-weight: bold;
      text-align: center;
    }
    .lunch-row td {
      background: #fff3d4;
      text-align: center;
      font-weight: bold;
    }

    .class-option {
      padding: 6px;
      margin-bottom: 4px;
      border-radius: 4px;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      position: relative;
    }
    .class-option.commitment { background: #fff7b0; border-left: 4px solid #dac62c; }
    .class-option.dropin     { background: #daf0ff; border-left: 4px solid #2274cd; }
    .class-option.private    { background: #ffdede; border-left: 4px solid #c93d3d; }
    .class-option.selected   { border: 2px solid orange; background: #fff2d5; }

    .info-icon {
      margin-left: 6px;
      font-size: 14px;
      cursor: pointer;
      color: #555;
    }

    .action-buttons {
      text-align: center;
      margin-top: 25px;
    }
    .action-btn {
      display: inline-block;
      background: #2a6f33;
      color: white;
      padding: 10px 22px;
      border-radius: 4px;
      border: none;
      font-size: 15px;
      cursor: pointer;
      margin: 0 6px;
    }
    .action-btn.secondary { background: #2274cd; }
    .action-btn.danger { background: #c93d3d; }

    #undo-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #555;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      display: none;
    }

    /* Modal styling */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
      overflow: auto;
    }
    .modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border-radius: 6px;
      width: 90%;
      max-width: 400px;
      position: relative;
    }
    .close-btn {
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: 18px;
      font-weight: bold;
      color: #333;
      cursor: pointer;
    }
    .modal-content h3 {
      margin-top: 0;
    }

    /* PRINT FOOTER */
    #printMeta {
      display:none;
      font-size: 10px;
      text-align: right;
      margin-top: 10px;
    }

    @media print {
      body { background: white; padding: 0; zoom: 92%; }
      .student-info, .tabs, .filters, .action-buttons, #undo-btn { display: none !important; }
      .container { border: none; padding: 0; box-shadow: none; }
      #printMeta {
        display: block !important;
        position: fixed;
        bottom: 10px;
        right: 20px;
        font-size: 10px;
        color: #444;
      }
      input[type="checkbox"] {
        display: none !important;
      }
    }

    /* Responsive tweaks */
    @media (max-width: 600px) {
      .tabs { flex-direction: column; }
      .tab { width: 100%; text-align: center; }
      .schedule-table th, .schedule-table td { font-size: 10px; padding: 4px; }
      .time-col { width: 80px; }
    }
  </style>

  <!-- jsPDF + AutoTable from CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>

<body>
  <button id="undo-btn" onclick="undo()">Undo</button>

  <div class="container">
    <h1>Session 3 Schedule Builder</h1>

    <div class="student-info">
      <input id="studentName" placeholder="Enter student name...">
    </div>

    <div class="filters">
      <label><input type="checkbox" class="filter-type" value="commitment" checked> Commitment</label>
      <label><input type="checkbox" class="filter-type" value="dropin" checked> Drop‑in</label>
      <label><input type="checkbox" class="filter-type" value="private" checked> Private</label>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('full')">Full Schedule</button>
      <button class="tab" onclick="switchTab('my')">My Schedule</button>
    </div>

    <div id="full-tab" class="tab-content active"></div>
    <div id="my-tab" class="tab-content">
      <div id="myScheduleList"></div>
    </div>

    <div class="action-buttons">
      <button class="action-btn secondary" onclick="exportPDF()">Export PDF</button>
      <button class="action-btn secondary" onclick="printSchedule()">Print Schedule</button>
      <button class="action-btn danger" onclick="clearSchedule()">Clear My Schedule</button>
    </div>

    <div id="printMeta"></div>
  </div>

  <!-- Modal HTML -->
  <div id="infoModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <h3 id="modalTitle"></h3>
      <p><strong>Teacher:</strong> <span id="modalTeacher"></span></p>
      <p><strong>Program / Room:</strong> <span id="modalProgRoom"></span></p>
      <p><strong>Notes:</strong> <span id="modalNotes"></span></p>
      <p id="modalDesc"></p>
    </div>
  </div>

  <script>
    /* MASTER DATA */
    const TIMES = ["10:00-10:45","10:50-11:35","11:35-12:05","12:10-12:55","1:00-1:50","1:55-2:45"];
    const DAYS  = ["Monday","Tuesday","Wednesday","Thursday","Friday"];
    // Example enhanced class data:
    const classes = {
      "10:00-10:45": {
        Monday:   { title: "Chemistry Lab", type: "commitment", teacher: "Anna", room: "JR", program: "Canopy+", notes: "Lab work & experiments", description: "Hands‑on chemistry experiments, all safety gear provided." },
        Tuesday:  { title: "Art Room", type: "dropin", teacher: "Tyleen", room: "AR", program: "Saplings+", notes: "Drop‑in open art", description: "Creative open‑studio art time."},
        Wednesday:{ title: "Math Group A", type: "commitment", teacher: "Anna", room: "JR", program: "Canopy+", notes: "Algebra & Geometry, full‑year", description: "Focused math curriculum covering algebra & geometry."},
        Thursday: { title: "1:1 Music Lesson", type: "private", teacher: "Music Teacher", room: "MR", program: "Private", notes: "Individual lesson", description: "One‑on‑one music lesson, instrument & level per student."},
        Friday:   null
      },
      "10:50-11:35": {
        Monday:   { title: "Open Drawing", type: "dropin", teacher: "Ashlyn", room: "AR", program: "Saplings+", notes: "Casual drawing drop‑in", description: "Free drawing time — bring your sketchbook."},
        Tuesday:  { title: "Civics", type: "commitment", teacher: "Jenique", room: "CR", program: "Canopy+", notes: "Social studies", description: "Civics and social science."},
        Wednesday:{ title: "Writing Lab", type: "commitment", teacher: "Elliott", room: "Cafe", program: "Canopy+", notes: "Writing & composition", description: "Creative & academic writing workshop."},
        Thursday: { title: "Free Reading", type: "dropin", teacher: "---", room: "LR", program: "Saplings+", notes: "Quiet reading time", description: "Bring a book or borrow one from the shelf."},
        Friday:   { title: "Piano Lesson", type: "private", teacher: "Piano Teacher", room: "LR", program: "Private", notes: "Individual lesson", description: "One‑on‑one piano instruction."}
      },
      "11:35-12:05": "Lunch",
      "12:10-12:55": {
        Monday:   { title: "Connection Circle", type: "commitment", teacher: "Anna", room: "JR", program: "Canopy+", notes: "Group bonding", description: "Circle time for community building."},
        Tuesday:  { title: "Active Games", type: "dropin", teacher: "---", room: "GYM", program: "Saplings+", notes: "All‑inclusive games", description: "Fun group games and movement."},
        Wednesday:{ title: "Garden Club", type: "dropin", teacher: "Garden Teacher", room: "Garden", program: "Saplings+", notes: "Max 8 students", description: "Gardening activities and nature exploration."},
        Thursday: { title: "Japanese", type: "commitment", teacher: "Japanese Teacher", room: "JR", program: "Canopy+", notes: "Language study", description: "Japanese language class for continuing students."},
        Friday:   null
      },
      "1:00-1:50": {
        Monday:   { title: "Songwriting", type: "commitment", teacher: "Music Teacher", room: "MR", program: "Canopy+", notes: "Music & lyrics", description: "Songwriting sessions for composition and performance."},
        Tuesday:  { title: "Cooking", type: "dropin", teacher: "Kitchen Teacher", room: "KT", program: "Saplings+", notes: "Hands‑on cooking", description: "Simple cooking recipes and kitchen practice."},
        Wednesday:{ title: "Open Art", type: "dropin", teacher: "Art Teacher", room: "AR", program: "Saplings+", notes: "Free art time", description: "Open‑studio art projects and creativity."},
        Thursday: { title: "Photography", type: "commitment", teacher: "Photo Teacher", room: "PR", program: "Canopy+", notes: "Photo & editing", description: "Photography basics & photo‑editing projects."},
        Friday:   null
      },
      "1:55-2:45": {
        Monday:   { title: "Sensory Lab", type: "dropin", teacher: "Lab Teacher", room: "LR", program: "Saplings+", notes: "Sensory‑focused play", description: "Sensory activities and exploration."},
        Tuesday:  { title: "Test Prep", type: "commitment", teacher: "Test Teacher", room: "CR", program: "Canopy+", notes: "Academic prep", description: "Test preparation and academic review sessions."},
        Wednesday:{ title: "Theatre", type: "commitment", teacher: "Drama Teacher", room: "TR", program: "Canopy+", notes: "Drama & acting", description: "Theatre class with acting, playwriting, performance."},
        Thursday: { title: "Debate Club", type: "commitment", teacher: "Debate Teacher", room: "DR", program: "Canopy+", notes: "Discussion & debate", description: "Debate club meetings — public speaking & reasoning."},
        Friday:   null
      }
    };

    let selected = {};
    let undoStack = [];

    function getFilterState() {
      return Array.from(document.querySelectorAll('.filter-type'))
        .filter(cb => cb.checked)
        .map(cb => cb.value);
    }

    function renderFull() {
      const filters = getFilterState();
      let html = `<table class="schedule-table"><thead><tr><th class="time-col">Time</th>${DAYS.map(d=>`<th>${d}</th>`).join('')}</tr></thead><tbody>`;

      TIMES.forEach(time => {
        if (time === "11:35-12:05") {
          html += `<tr class="lunch-row"><td class="time-col">${time}</td><td colspan="5">Lunch</td></tr>`;
          return;
        }
        html += `<tr><td class="time-col">${time}</td>`;
        DAYS.forEach(day => {
          const entry = classes[time][day];
          if (!entry || !filters.includes(entry.type)) {
            html += `<td></td>`;
          } else {
            const key = `${time}-${day}`;
            const isSel = selected[key] === entry.title;
            html += `<td>
              <div class="class-option ${entry.type} ${isSel?'selected':''}" onclick="choose('${key}','${entry.title}')">
                <span class="class-name">${entry.title}</span>
                <span class="info-icon" onclick="showInfo(event, '${key}', '${day}')">ℹ️</span>
              </div>
            </td>`;
          }
        });
        html += `</tr>`;
      });

      html += `</tbody></table>`;
      document.getElementById("full-tab").innerHTML = html;
    }

    function renderMine() {
      let html = `<table class="schedule-table"><thead><tr><th>Time</th><th>Class</th></tr></thead><tbody>`;
      TIMES.forEach(time => {
        html += `<tr><td class="time-col">${time}</td><td>`;
        const found = Object.entries(selected).find(([k, v]) => k.startsWith(time));
        html += found ? found[1] : "";
        html += `</td></tr>`;
      });
      html += `</tbody></table>`;
      document.getElementById("myScheduleList").innerHTML = html;
    }

    function choose(key, title) {
      undoStack.push({ key, prev: selected[key] || null });
      document.getElementById("undo-btn").style.display = 'inline-block';
      selected[key] = title;
      saveLocal();
      renderFull();
      renderMine();
    }

    function undo() {
      const last = undoStack.pop();
      if (!last) return;
      if (last.prev === null) delete selected[last.key];
      else selected[last.key] = last.prev;
      if (undoStack.length === 0) document.getElementById("undo-btn").style.display = 'none';
      saveLocal();
      renderFull();
      renderMine();
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');
      document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
      document.getElementById(`${tab}-tab`).classList.add('active');
    }

    function saveLocal() {
      localStorage.setItem("MY_SCHEDULE_DATA", JSON.stringify(selected));
      localStorage.setItem("STUDENT_NAME", document.getElementById("studentName").value.trim());
    }

    function restore() {
      const s = localStorage.getItem("MY_SCHEDULE_DATA");
      if (s) selected = JSON.parse(s);
      const n = localStorage.getItem("STUDENT_NAME");
      if (n) document.getElementById("studentName").value = n;
    }

    function printSchedule() {
      const today = new Date().toLocaleDateString();
      const footer = document.getElementById("printMeta");
      footer.textContent = `Created ${today}`;
      footer.style.display = "block";
      setTimeout(() => window.print(), 200);
    }

    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'pt', 'a4');
      const name = document.getElementById("studentName").value.trim() || "Schedule";
      doc.text(`${name} — My Schedule`, 40, 40);

      const body = TIMES.map(time => {
        const found = Object.entries(selected).find(([k, v]) => k.startsWith(time));
        return [time, found ? found[1] : ""];
      });

      doc.autoTable({
        head: [['Time', 'Class']],
        body,
        startY: 70,
        styles: { fontSize: 10 }
      });
      doc.save(`${name.replace(/\s+/g, "_")}_schedule.pdf`);
    }

    function clearSchedule() {
      if (!confirm("Clear your selected schedule?")) return;
      selected = {};
      undoStack = [];
      document.getElementById("undo-btn").style.display = 'none';
      saveLocal();
      renderFull();
      renderMine();
    }

    // Modal logic
    function showInfo(event, key, day) {
      event.stopPropagation();
      const [time, d] = key.split('-').slice(0,2);
      const entry = classes[time][day];
      if (!entry) return;
      document.getElementById("modalTitle").textContent = entry.title;
      document.getElementById("modalTeacher").textContent = entry.teacher;
      document.getElementById("modalProgRoom").textContent = `${entry.program} · Room: ${entry.room}`;
      document.getElementById("modalNotes").textContent = entry.notes;
      document.getElementById("modalDesc").textContent = entry.description;
      document.getElementById("infoModal").style.display = 'block';
    }

    function closeModal() {
      document.getElementById("infoModal").style.display = 'none';
    }

    // Init
    restore();
    renderFull();
    renderMine();
    document.querySelectorAll('.filter-type').forEach(cb => cb.addEventListener('change', renderFull));

    window.onclick = function(e) {
      const modal = document.getElementById("infoModal");
      if (e.target === modal) closeModal();
    };
  </script>
</body>
</html>
